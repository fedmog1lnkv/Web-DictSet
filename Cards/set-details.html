<!DOCTYPE html>
<html>
<head>
    <title>Set Details</title>
	<meta charset="UTF-8">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap"
		rel="stylesheet">
    <style>
        body {
            margin: 50px 250px 10px 250px ;
            font-family: 'Titillium Web', sans-serif;
            background-color: #F8FAFC;
        }

        .logo {
            width: 300px;
            height: 80px;
            cursor: pointer;
        }

        header {
            display: flex;
            justify-content: left;
            align-items: left;
            height: 100px;
            width: 1000px;
            margin: 0 auto;
        }

        .workplace {
            display: block;
            width: 1000px;
            height: 1000px;
            margin: 0 auto;
            padding: 20px;
        }   

        .workplace__header {
            display: block;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0px;
        }

        .set-name{
            font-size: 40px;
            font-weight: 600;
            margin: 0;
        }

        .btn-start-dict {
            width: 150px;
         
            background-color: #7C3AED;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            line-height: 24px;
        }
        
        .btn-start-dict:hover {
            background-color: #6931c9;
        }

        .btn-start-dict:active {
            background-color: #572aa5;
        }

        .btn-add-words {
            width: 175px;
            height: 50px;
            background-color: #7C3AED;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            line-height: 24px;
        }
        
        .btn-add-words:hover {
            background-color: #6931c9;
        }

        .btn-add-words:active {
            background-color: #572aa5;
        }

        .word-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
            
        }
        
        .word-pair {
            display: block;
            background-color: white;
            margin-bottom: 20px;
            /* border: 2px rgb(207, 207, 207) solid; */
            padding: 10px 10px 10px 10px;
            border-radius: 6px;
            box-shadow: 0px 5px 5px rgba(0, 0, 0, 0.144);
            transition: transform 0.3s ease-in-out, box-shadow 0.2s ease-in-out, border-radius 0.2s ease-in-out;
            cursor: pointer;
            
        }

        .word-pair:hover {
            border-radius: 8px;
            transform: translateY(-3px);
            box-shadow: 0px 5px 5px hsla(0, 0%, 0%, 0.219); 
        }

        .word-div{
            display: flex;
            text-align: left;
            font-size: 20px;
            font-weight: 600;
        }

        .word {
            margin-right: 5px;
        }

        .word::after{
            content: " -";
        }
    

        .description{
            font-size: 18px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9990;
            opacity: 0;
            pointer-events: none;
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 700px;
            height: auto;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.25);
            padding: 20px;
            box-sizing: border-box;
            z-index: 10000;
            padding: 30px 25px 30px 25px;
        }

        .popup-word-pair {
            display: flex;
            text-align: left;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .popup-word, .popup-translation, .popup-description{
            font-size: 20px;
        }
       
        .popup-word::after {
            content: " -";
        }

        .popup-word{
            margin-right: 5px;
        }

        .popup-word-title{
            font-size: 35px;
            font-weight: 600;
        }

        .btn-add-one-word {
            background-color: #7C3AED;
            border-radius: 5px;
            color: white;
            border: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px; 
            height: 40px; 
            font-size: 30px; 
            font-weight: 100;
            margin: 0 auto; 
            cursor: pointer;
        }

        .btn-add-one-word:hover {
            background-color: #6931c9;
        }

        .btn-add-one-word:active {
            background-color: #572aa5;
        }

        .pagination {
            /* margin-top: 10px; */
            margin-bottom: 10px;
            justify-content: center;
            align-items: center;
            text-align: right;
        }

        .page-number {
            display: inline-block;
            margin-right: 5px;
            padding: 5px 10px;
            background-color: #f0f0f0;
            cursor: pointer;
        }

        .page-number:hover {
            background-color: #e0e0e0;
        }

        .page-number.active {
            background-color: #ccc;
            cursor: default;
        }

        .add-word-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
            z-index: 9991;
        }
        
        .add-word-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            width: 625px;
        }

        .add-word-title {
        font-size: 24px;
        font-weight: bold;
        /* margin-bottom: 10px; */
        text-align: left;
        }

        .add-word-input, .add-translate-input,
        .add-description-input {
        width: 95%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        }

        .add-description-input{
            height: 50px;
        }


        .btn-add-word {
            background-color: #7C3AED;
            border-radius: 5px;
            color: white;
            border: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 110px; 
            height: 30px; 
            font-size: 14px; 
            font-weight: 600;
            margin: 0 auto; 
            cursor: pointer;
        }

        .btn-add-word:hover {
            background-color: #6931c9;
        }

        .btn-add-word:active {
            background-color: #572aa5;
        }

        /* Новое */
        
        
.add-word-content-header{
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    margin-top: 10px;
}


.add-many-words-button {
  background-color: #ffffff;
  color: #7C3AED;
  border: 0;
  width: auto; 
  height: auto; 
  font-size: 14px;
  font-weight: 600; 
  padding: 0;
  cursor: pointer;
}

.add-many-words-button:hover {
  color: #6931c9;
}

.add-many-words-button:active {
  color: #572aa5;
}

.modal-title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 10px;
  text-align: left;
  margin-top: 10px;
}

.modal-description {
  font-size: 16px;
  margin-bottom: 10px;
  text-align: left;
}

.add-words-input {
  width: 96%;
  height: 125px;
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.add-words-button {
  background-color: #7C3AED;
  border-radius: 5px;
  color: white;
  border: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 110px; 
  height: 30px; 
  font-size: 14px; 
  font-weight: 600;
  margin: 0 auto; 
  cursor: pointer;
}

.add-words-button:hover {
  background-color: #6931c9;
}

.add-words-button:active {
  background-color: #572aa5;
}


/* НОВЕЙ */
.add-words-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* background-color: rgba(0, 0, 0, 0.5); */
  transition: opacity 0.3s ease;
  /* backdrop-filter: blur(5px); */
  z-index: 9992;
}

.modal-content{
    position: absolute;
    min-width: 626px;
    min-height: 300px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    text-align: center;    
}

.search-box {
    width: 100%;
    height: 55px;
    padding: 10px;
    font-size: 18px;
    font-weight: 600;
    box-sizing: border-box;
    border: 2px solid #ccc;
    border-radius: 4px;
    margin-right: 20px;
}

.workplace__search {
    position: relative;
    margin-bottom: 20px;
    display: flex;
}

.close-add-word-popup, .close-add-words-modal, .close-word-popup {
  position: absolute;
  color: #E2E8F0;
  top: -8px;
  right: 10px;
  font-size: 30px;
  font-weight: bold;
  cursor: pointer;
}

.close-add-word-popup:hover, .close-add-words-modal:hover, .close-word-popup:hover{
    color: #c5ced8;
}

hr{ 
    background-color: black;
    border: 1px black solid;
    width: 1000px;
    margin-bottom: 20px;
}

/* .word-pair {
    text-align: center;
} */

.delete-word { 
    position: absolute;
    font-size: 16px;
    bottom: 8px;
    right: 7px;
    opacity: 0.5;
    transition: all 0.3s ease-out;
    cursor: pointer;
    }

    .delete-word:hover { 
    opacity: 1;
    }


    .word-pair .delete-word {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.word-pair:hover .delete-word {
  opacity: 1;
}


    </style>
</head>
<body>
    <header>
        <a href="cards.html">
            <img src="../files/logo.png" alt="Логотип" class="logo">
        </a>
    </header>

    <div class="workplace">
        <div class="workplace__header">
            <p class="set-name" id="set-name"></p>
            <hr>
        </div>
        <div class="workplace__search">
            <input type="text" placeholder="Find Word 🔎" class="search-box">
            <button class="btn-start-dict" id="btn-start-dict">start</button>
        </div>
        <div id="pagination" class="pagination"></div>
        <div id="word-container" class="word-container"></div>
        <button class="btn-add-one-word">+</button>
    </div>

    <div class="popup-overlay">
        <div class="popup-content">
            <span class="close-word-popup">&times;</span>
            <button class="delete-word">🗑️</button>
            <div class="popup-word-pair">
                <div class="popup-word"></div>
                <div class="popup-translation"></div>   
            </div>
            <div class="popup-description"></div>  
        </div>
    </div>

     <div class="add-word-popup" id="add-word-popup">
        <div class="add-word-content">
            <span class="close-add-word-popup">&times;</span>
            <div class="add-word-content-header">
                <div class="add-word-title">Add word</div>
                <button class="add-many-words-button">Many words</button>
            </div>
            <input type="text" class="add-word-input" id="add-word-input" placeholder="Word">
            <input type="text" class="add-translate-input" id="add-translate-input" placeholder="Translation">
            <input type="text" class="add-description-input" id="add-description-input" placeholder="Description">
            <button class="btn-add-word" id="btn-add-word">ADD WORD</button>
        </div>
    </div>

    <!-- Modal window -->
<div class="add-words-modal">
    <div class="modal-content">
        <span class="close-add-words-modal">&times;</span>
      <div class="modal-title">Add words as a list</div>
      <div class="modal-description">
        <div>Insert the words into the form</div>
        <div>By default, the separator between the columns is Tab, between the lines Enter</div>
    </div>
      <textarea id="add-words-input" class="add-words-input" placeholder="Word 1 Translate 1 Description 1&#10;Word 2 Translate 2 Description 2" ></textarea>
      <button class="add-words-button">ADD WORDS</button>
    </div>
  </div>

    <script>
    const params = new URLSearchParams(window.location.search);
  const setName = params.get('setName');
  const words = params.get('words');

  // Отправить запрос на сервер для получения данных по токену и id
  const token = params.get('token');
  const setId = params.get('id');
  const apiUrl = `http://62.84.121.82:8080/api/Set/${token}/${setId}`;

  fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const setInfo = data.data.setInfo;

                console.log(setInfo)

                const words = data.data.words;
                const wordsString = data.data.words.map(word => `${word.word}-${word.translate}`).join(';');
                const btnStartDict = document.getElementById('btn-start-dict');   
                btnStartDict.addEventListener('click', function() {
                const dictPageUrl = `dict-page.html?words=${encodeURIComponent(wordsString)}`;
                window.location.href = dictPageUrl;
            });


                console.log(words);

                // Обновление названия сета
                const setNameElement = document.getElementById('set-name');
                setNameElement.textContent = setInfo.name;

                // Остальная обработка полученных данных
                const wordContainer = document.getElementById('word-container');
                const pagination = document.getElementById('pagination');
                const pageSize = 7; // Number of words to display per page
                let currentPage = 1;

                const updateWords = () => {
                    wordContainer.innerHTML = ''; // Clear existing words

                    const startIndex = (currentPage - 1) * pageSize;
                    const endIndex = startIndex + pageSize;
                    const currentPageWords = words.slice(startIndex, endIndex);

                    currentPageWords.forEach((word) => {
                        const wordId = word.id

                        const div = document.createElement('div');
                        div.classList.add('word-pair');
                        div.classList.add(`id-${wordId}`);

                        const wordDiv = document.createElement('div');
                        wordDiv.classList.add('word-div');

                        const wordElement = document.createElement('div');
                        wordElement.classList.add('word');
                        wordElement.textContent = word.word;

                        const translationElement = document.createElement('div');
                        translationElement.classList.add('translation');
                        translationElement.textContent = word.translate;

                        const descriptionElement = document.createElement('div');
                        descriptionElement.classList.add('description');
                        descriptionElement.textContent = word.description;

                        div.appendChild(wordDiv);
                        wordDiv.appendChild(wordElement);
                        wordDiv.appendChild(translationElement);
                        div.appendChild(descriptionElement);

                        wordContainer.appendChild(div);

                        // Add click event listener to word-pair divs
                        div.addEventListener('click', () => {
                            const popupOverlay = document.querySelector('.popup-overlay');
                            const popupWordPair = document.querySelector('.popup-word-pair');
                            const popupWord = popupWordPair.querySelector('.popup-word');
                            const popupTranslation = popupWordPair.querySelector('.popup-translation');
                            const popupDescription = document.querySelector('.popup-description');
                            const wordId = word.id;

                            // Переносим айди в класс popup-word-pair
                            const popupContent= document.querySelector('.popup-content');
                            popupContent.classList.add(`id-${wordId}`);

                            popupWord.textContent = word.word;
                            popupTranslation.textContent = word.translate;
                            popupDescription.textContent = word.description;
                            popupOverlay.style.opacity = 1;
                            popupOverlay.style.pointerEvents = 'auto';
                        });

                   

                    });
updatePagination();
            };

            const updatePagination = () => {
                pagination.innerHTML = ''; // Clear pagination

                const numPages = Math.ceil(words.length / pageSize);

                for (let i = 1; i <= numPages; i++) {
                    const pageNumber = document.createElement('span');
                    pageNumber.classList.add('page-number');
                    pageNumber.textContent = i;
                    pageNumber.addEventListener('click', () => {
                        currentPage = i;
                        updateWords();
                    });

                    if (i === currentPage) {
                        pageNumber.classList.add('active');
                    }

                    pagination.appendChild(pageNumber);
                }
            };

            updateWords();
        })
        .catch(error => console.error(error));

    const addButton = document.querySelector('.btn-add-one-word');
    const popup = document.querySelector('.add-word-popup');
    const closeButton = document.querySelector('.add-word-popup .btn-add-word');

    addButton.addEventListener('click', () => {
        popup.style.display = 'block';
    });

    closeButton.addEventListener('click', () => {
        popup.style.display = 'none';
    });


    const closeWordModal = document.querySelector('.close-add-word-popup');
    window.addEventListener('click', (event) => {
        if (event.target === popup || event.target === closeWordModal) {
            popup.style.display = 'none';
        }
    });

    const closeWordPopup = document.querySelector('.close-word-popup')
    window.addEventListener('click', (event) => {
                        const popupOverlay = document.querySelector('.popup-overlay');
                        if (event.target === popupOverlay || event.target === closeWordPopup) {
                            popupOverlay.style.opacity = 0;
                            popupOverlay.style.pointerEvents = 'none';
                        }
                    });

                    const addWordButton = document.querySelector('.add-many-words-button');
const addWordsModal = document.querySelector('.add-words-modal');
const addWordsInput = document.querySelector('.add-words-input');
const addWordsButton = document.querySelector('.add-words-button');

addWordButton.addEventListener('click', () => {
  addWordsModal.style.display = 'block';
});

const closeWordsModal = document.querySelector('.close-add-words-modal');
window.addEventListener('click', (event) => {
    if (event.target === addWordsModal || event.target === closeWordsModal) {
      addWordsModal.style.display = 'none';
    }
  });

  
addWordsButton.addEventListener('click', () => {
  const wordsList = addWordsInput.value;
  const wordsArray = wordsList.split('\n');
  addWordsModal.style.display = 'none';
  addWordsInput.value = '';
});


    </script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.delete-word');
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const token = params.get('token');
                const setId = params.get('id');
                const wordPair = this.parentNode;
                console.log(wordPair);
                const wordPairId = wordPair.classList[1].replace('id-', '');
                
                const apiUrl = 'http://62.84.121.82:8080/api/Set/deleteWords';
                const data = {
                    accessToken: token,
                    setId: setId,
                    IdWordsForDelete: [wordPairId]
                };
                
                fetch(apiUrl, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    console.log(result);
                    // Обработка успешного ответа от сервера
                    // Например, удаление соответствующего элемента из DOM
                    wordPair.remove();
                    window.location.reload();
                })
                .catch(error => {
                    console.error(error);
                    // Обработка ошибки при выполнении запроса
                });
            });
        });
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        var addWordsButton = document.querySelector('.add-words-button');
        var addWordsInput = document.querySelector('#add-words-input');
        var addWordButton = document.getElementById("btn-add-word");
        var wordInput = document.getElementById("add-word-input");
        var translateInput = document.getElementById("add-translate-input");
        var descriptionInput = document.getElementById("add-description-input");

        addWordsButton.addEventListener('click', function() {
            var inputText = addWordsInput.value.trim();

            if (inputText === '') {
                alert("You haven't entered anything");
                return;
            }

        
        });

        addWordButton.addEventListener("click", function() {
            if (wordInput.value === "" || translateInput.value === "" || descriptionInput.value === "") {
                alert("You have not filled in one of the fields");
                return;
            } else {
                const word = wordInput.value;

                const translation = translateInput.value;
                const description = descriptionInput.value;

                const params = new URLSearchParams(window.location.search);
                const token = params.get('token');
                const setId = params.get('id');

                const apiUrl = 'http://62.84.121.82:8080/api/Set/addWords';
                const data = {
                    accessToken: token,
                    setId: setId,
                    WordsForAdd: [{
                        Word: word,
                        Translate: translation,
                        Description: description
                    }]
                };

                fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        window.location.reload();
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }
        });
    });
</script>
</body>

</html>