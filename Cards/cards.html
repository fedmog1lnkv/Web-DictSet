<!DOCTYPE html>
<html>
<head>
	<title>Workplace</title>
	<meta charset="UTF-8">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" href="style-for-cards.css">
</head>
<body>
	<header>
		<img src="../files/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo">
	</header>
	<main>
		<div class="workplace">
			<div class="workplace__header">
				<p class="setstxt">Sets</p>
				<button class="create-set">CREATE A SET</button>
			</div>
			<div class="workplace__search">
				<input type="text" placeholder="Find Set üîé" class="search-box">
			</div>
			<div class="card-set">
				<!-- –ü—Ä–∏–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ -->
				<!-- <div class="card">
					<div class="card-content">
						<div class="card-title">Card title</div>
						<div class="card-word-count">Count words</div>
						<div class="card-line"></div>
						<div class="card-learn">Learn</div>
					</div>
				</div> -->
			</div>
			<div class="popup-container-create-set">
				<div class="popup-create-set">
					<span class="close-popup-container">&times;</span>
				  <h2>Enter the name of the set</h2>
				  <input type="text" placeholder="Set name" id="setNameInput">
				  <button class="create-button">CREATE</button>
				</div>
			</div>
        </div>
	</main>

	
	<script src="https://cdn.jsdelivr.net/npm/randomcolor/randomColor.min.js"></script>


	<script>
		const cardSet = document.querySelector('.card-set');
	
		// –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∫—É–∫–∏
		const token = document.cookie.split(';').map(cookie => cookie.split('=')).find(([key, value]) => key.trim() === 'token');
		if (token) {
			const apiUrl = `http://62.84.121.82:8080/api/Set/${token[1]}`;
			console.log(apiUrl);
			// –ó–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
			fetch(apiUrl)
  .then(response => response.json())
  .then(data => {
    data.data.forEach(item => {
      const { name, countWords, id } = item;
      const card = document.createElement('div');
      card.classList.add('card');
      card.classList.add(`card-id-${id}`);
	  card.setAttribute('data-name', name); // –î–æ–±–∞–≤–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç data-name
	  card.setAttribute('data-id', id); // –î–æ–±–∞–≤–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç data-id
      cardSet.appendChild(card);

      const cardContent = document.createElement('div');
      cardContent.classList.add('card-content');
      card.appendChild(cardContent);

      const cardTitle = document.createElement('div');
      cardTitle.classList.add('card-title');
      cardTitle.textContent = name;
      cardContent.appendChild(cardTitle);

      const cardWordCount = document.createElement('div');
      cardWordCount.classList.add('card-word-count');
      cardWordCount.textContent = countWords + ' words';
      cardContent.appendChild(cardWordCount);

      const cardLine = document.createElement('div');
      cardLine.classList.add('card-line');
      cardContent.appendChild(cardLine);

      const cardLearn = document.createElement('div');
      cardLearn.classList.add('card-learn');
      cardLearn.textContent = 'Learn';
      cardContent.appendChild(cardLearn);

      const color = randomColor();
      const canvas = document.createElement('canvas');
      canvas.width = 300;
      canvas.height = 300;

      const ctx = canvas.getContext('2d');
      ctx.fillStyle = color;
      ctx.fillRect(0, 0, 300, 300);

      card.style.backgroundImage = `url(${canvas.toDataURL('image/png')})`;
    });
	const cards = document.querySelectorAll('.card');
  
  cards.forEach(card => {
	card.addEventListener('click', () => {
	  const name = card.getAttribute('data-name');
	  const id = card.getAttribute('data-id');
	  const token = document.cookie
		.split(';')
		.map(cookie => cookie.split('='))
		.find(([key, value]) => key.trim() === 'token');

	  const queryParams = new URLSearchParams({
		name,
		id,
		token: token ? token[1] : ''
	  });

	  window.location.href = `set-details.html?${queryParams.toString()}`;
	});
  });
  })
  .catch(error => console.error(error));
		}
	</script>

	<!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ç -->
	<script>
		const createSetButton = document.querySelector('.create-set');
		const popupContainer = document.querySelector('.popup-container-create-set');
		const popupCreateSet = document.querySelector('.popup-create-set');
		const createButton = document.querySelector('.create-button');
		const input = document.querySelector('input');

		createSetButton.addEventListener('click', () => {
		popupContainer.style.display = 'block';
		input.focus();
		});


		const closePopupContainer = document.querySelector('.close-popup-container');
		popupContainer.addEventListener('click', (e) => {
		if (e.target === popupContainer || e.target === closePopupContainer) {
			popupContainer.style.display = 'none';
		}
		});

// –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
// const createButton = document.querySelector('.create-button');
const setNameInput = document.getElementById('setNameInput');

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "CREATE"
createButton.addEventListener('click', function() {
  // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
  const setName = setNameInput.value;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ª–∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞
  if (setName === '') {
    alert("You didn't enter the name of the set");
    return;
  }

  // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
  const apiUrl = 'http://62.84.121.82:8080/api/Set/create';
  const requestBody = {
    accessToken: token[1],
    name: setName,
    description: null
  };

  fetch(apiUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(requestBody)
  })
    .then(response => response.json())
    .then(data => {
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
      console.log(data);
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
	  window.location.reload();
    })
    .catch(error => console.error(error));

	// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
	const popupContainer = document.querySelector('.popup-create-set');
	popupContainer.style.display = 'none';

	// –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
	setNameInput.value = '';
});

	</script>

	<!-- –ü–æ–∏—Å–∫ —Å–µ—Ç–æ–≤ -->
<script>
    const searchBox = document.querySelector('.search-box');
    searchBox.addEventListener('input', () => {
    const searchText = searchBox.value.trim().toLowerCase();
    filterCards(searchText);
    });

    function filterCards(searchText) {
    const cards = document.querySelectorAll('.card');
    cards.forEach((card) => {
    const title = card.querySelector('.card-title').textContent.toLowerCase();
    const wordCount = card.querySelector('.card-word-count').textContent.toLowerCase();
    if (title.includes(searchText) || wordCount.includes(searchText)) {
    card.style.display = 'flex';
    } else {
    card.style.display = 'none';
    }
    });
}
</script>

</body>
</html>